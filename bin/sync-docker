#! /bin/bash

export SRC=${1:-$(pwd)}
export DEST=${2:-"b2d:~/share"}
export EXCLUDE=${3:-"node_modules"}

# sync current directory to ~/share on the vm
boot2docker_sync() {
  echo -n "sync $(basename $SRC)"
  rsync -rlz --force --exclude ".git" --exclude $EXCLUDE $SRC $DEST
  #rsync -rlz --force --delete --exclude ".git" --exclude $EXCLUDE $SRC $DEST
  echo " ($(date +'%T'))"
}

export -f boot2docker_sync

boot2docker_sync
fswatch -o --exclude ".git" --exclude $EXCLUDE $SRC | xargs -n1 -I{} bash -c boot2docker_sync
